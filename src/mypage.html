<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRIDGE - 마이페이지</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/mypage.css">
</head>
<body>
    <header class="header">
        <div id="main_logo" class="logo" style="cursor: pointer;">
            <img src="images/logo.png" alt="BRIDGE 서비스 로고" class="logo-image">
        </div>
        <button class="logout-btn">로그아웃</button>
    </header>

    <div class="container">
        <h1 class="page-title">마이페이지</h1>

        <div class="card">
            <div class="profile-section">
                <div class="profile-image">
                    <img id="profile-icon" src="images/logo.png" alt="프로필 아이콘" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                </div>
                <div class="profile-info">
                    <div class="profile-header">
                        <div class="profile-name">정보</div>
                        <button class="edit-btn" onclick="handleEdit()">
                            <span>✎</span> 편집
                        </button>
                    </div>
                    <div class="info-row">
                        <div class="info-value" id="display-name">등록해주세요</div>
                        <div id="user-type-display" style="color: #3b82f6; font-weight: bold; font-size: 14px; margin-top: 4px;">등록된 유형 없음</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">전화번호</div>
                    </div>
                    <div class="info-row">
                        <div class="info-value" id="display-phone">등록해주세요</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="iot-section">
                <div class="iot-left">
                    <h2 class="iot-title">IoT 기기 연동</h2>
                    
                    <div class="device-info">
                        <div class="device-label">이름</div>
                        <div class="device-value" id="iot-name">등록해주세요</div>
                    </div>

                    <div class="device-info">
                        <div class="device-label">전화 번호</div>
                        <div class="device-value" id="iot-phone">등록해주세요</div>
                    </div>

                    <div class="device-info">
                        <div class="device-label">이메일</div>
                        <div class="device-value" id="display-email">불러오는 중...</div>
                    </div>

                    <div class="device-info">
                        <div class="device-label">관광객 기기 번호</div>
                        <div class="device-value">IOT-TEST-001</div>
                    </div>
                </div>

                <div class="iot-right">
                    <div class="toggle-row">
                        <div class="toggle-label">WiFi</div>
                        <div class="toggle-switch" onclick="this.classList.toggle('off')"></div>
                    </div>
                    <div class="toggle-row">
                        <div class="toggle-label">블루투스</div>
                        <div class="toggle-switch" onclick="this.classList.toggle('off')"></div>
                    </div>
                    <div class="toggle-row">
                        <div class="toggle-label">위치정보</div>
                        <div class="toggle-switch" onclick="this.classList.toggle('off')"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 로그인 체크
        (function checkLogin() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'true') {
                alert("로그인이 필요한 서비스입니다.");
                window.location.href = 'mainpage.html';
            }
        })();

        // 데이터 로드 (저장된 값이 있으면 덮어씌우고, 없으면 그대로 유지)
        window.onload = function() {
            const savedEmail = localStorage.getItem('userEmail') || "로그인 정보 없음";
            const savedName = localStorage.getItem('userName');
            const savedPhone = localStorage.getItem('userPhone');
            const savedType = localStorage.getItem('userType') || "등록된 유형 없음";
    
    // 1. 텍스트 데이터 반영
            if (savedName && savedName !== "null") {
                document.getElementById('display-name').innerText = savedName;
                document.getElementById('iot-name').innerText = savedName;
            }
            if (savedPhone && savedPhone !== "null") {
                document.getElementById('display-phone').innerText = savedPhone;
                document.getElementById('iot-phone').innerText = savedPhone;
            }
            document.getElementById('display-email').innerText = savedEmail;
            const typeDisplay = document.getElementById('user-type-display');
            if (typeDisplay) typeDisplay.innerText = savedType;

    // 2. 프로필 아이콘 설정 및 오류 방지
            const profileIcon = document.getElementById('profile-icon');

    // [중요] 이미지를 불러오지 못했을 때 실행될 코드
            profileIcon.onerror = function() {
                console.log("이미지를 찾을 수 없어 로고로 대체합니다.");
            this.src = 'images/logo.png'; 
            };

            if (savedType === '시각장애인') profileIcon.src = 'images/visual.png';
            else if (savedType === '청각장애인') profileIcon.src = 'images/hearing.png';
            else if (savedType === '지체장애인') profileIcon.src = 'images/physical.png';
            else profileIcon.src = 'images/logo.png';
        };
        // 편집 기능
        function handleEdit() {
            const currentName = document.getElementById('display-name').innerText;
            const currentPhone = document.getElementById('display-phone').innerText;

            const initialName = (currentName === "등록해주세요") ? "" : currentName;
            const initialPhone = (currentPhone === "등록해주세요") ? "" : currentPhone;

            const newName = prompt("성명을 입력하세요:", initialName);
            if (!newName) return;
            const newPhone = prompt("전화번호를 입력하세요:", initialPhone);
            if (!newPhone) return;

            localStorage.setItem('userName', newName);
            localStorage.setItem('userPhone', newPhone);
            location.reload();
        }

        // 로그아웃
        document.querySelector('.logout-btn').addEventListener('click', function() {
            if (confirm("로그아웃 하시겠습니까?")) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('userType');
                localStorage.removeItem('userName');
                localStorage.removeItem('userPhone');
                window.location.href = 'mainpage.html';
            }
        });

        // 로고 클릭
        document.getElementById('main_logo').onclick = () => location.href='mainpage.html';
    </script>
</body>
</html>