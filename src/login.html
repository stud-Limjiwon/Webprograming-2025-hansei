<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - BRIDGE</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/login.css">
</head>
<body>
    <header class="header">
        <a href="mainpage.html" class="logo">
            <span class="a11y-hidden">BRIDGE</span>
        </a>
    </header>

    <div class="login-container">
        <div class="login-box">
            <div class="form-group">
                <label class="form-label">아이디</label>
                <input type="text" id="user-id" class="form-input" placeholder="example@domain.com">
            </div>

            <div class="form-group">
                <label class="form-label">비밀번호</label>
                <input type="password" id="user-pw" class="form-input" placeholder="비밀번호를 입력하세요.">
                <small class="form-helper">* 비밀번호는 4자 이상 입력해주세요.</small>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="agree" class="checkbox-input" checked>
                <label for="agree" class="checkbox-label">이용약관 동의</label>
            </div>

            <button class="btn btn-primary" onclick="handleLogin()">로그인</button>

            <div class="link-group">
                <a href="#" class="link">아이디/비밀번호 찾기</a>
                <a href="#" class="link">회원가입</a>
            </div>
        </div>
    </div>

    <script src="javaScript/constants.js"></script>
    <script src="javaScript/modal.js"></script>
    
    <script>
        function handleLogin() {
            const idInput = document.getElementById('user-id').value.trim();
            const pwInput = document.getElementById('user-pw').value;
            const agreeCheck = document.getElementById('agree').checked;
            
            // 1. 이용약관 동의 확인
            if (!agreeCheck) {
                ModalSystem.warning('이용약관에 동의해주세요.', '약관 동의 필요').then(() => {
                    document.getElementById('agree').focus();
                });
                return;
            }
            
            // 2. 아이디 검증
            if (!idInput) {
                ModalSystem.warning('아이디를 입력해주세요.', '입력 오류');
                return;
            }
            
            if (!idInput.includes('@')) {
                ModalSystem.warning('아이디에 @도메인을 포함해주세요.<br>(예: user@email.com)', '아이디 형식 오류');
                return;
            }

            // 3. 비밀번호 검증
            if (!pwInput) {
                ModalSystem.warning('비밀번호를 입력해주세요.', '입력 오류');
                return;
            }
            
            if (pwInput.length < 4) {
                ModalSystem.warning('비밀번호를 4자 이상 입력해주세요.', '비밀번호 형식 오류');
                return;
            }

            // 4. 로그인 성공 처리
            try {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userEmail', idInput);
                
                ModalSystem.success('로그인에 성공하였습니다!', '로그인 성공').then(() => {
                    window.location.href = 'mainpage.html';
                });
            } catch (error) {
                console.error('로그인 처리 중 에러:', error);
                ModalSystem.error('로그인 처리 중 오류가 발생했습니다.');
            }
        }
        
        // Enter 키로 로그인
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('user-pw').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            document.getElementById('user-id').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
        });
    </script>
</body>
</html>